# Настройка автодеплоя на Railway через GitHub

## Инструкция по настройке

### Шаг 1: Подключение GitHub репозитория в Railway

1. Откройте [Railway Dashboard](https://railway.app/dashboard)
2. Войдите в свой аккаунт
3. Создайте новый проект или откройте существующий
4. Нажмите **"New"** → **"GitHub Repo"**
5. Выберите репозиторий `Nalivator3000/UA-IP-parcer`
6. Railway автоматически определит проект как Node.js

### Шаг 2: Настройка автодеплоя

1. В настройках проекта перейдите в **Settings** → **Service**
2. Найдите раздел **"Deploy"**
3. Убедитесь, что включена опция **"Auto Deploy"**
4. Выберите ветку для автодеплоя: **`main`**
5. Railway будет автоматически деплоить при каждом push в ветку `main`

### Шаг 3: Настройка переменных окружения

В **Settings** → **Variables** добавьте:

- `DATABASE_URL` - строка подключения к PostgreSQL
  ```
  postgresql://postgres:password@host:port/database
  ```
- `PORT` - порт (Railway установит автоматически, но можно указать вручную)
- `NODE_ENV` - `production`

### Шаг 4: Проверка деплоя

1. Сделайте push в ветку `main`:
   ```bash
   git push origin main
   ```

2. В Railway Dashboard вы увидите:
   - Новый деплой в разделе **Deployments**
   - Логи сборки и запуска
   - URL вашего приложения

### Шаг 5: Настройка домена (опционально)

1. В **Settings** → **Networking**
2. Нажмите **"Generate Domain"** для автоматического домена
3. Или добавьте свой кастомный домен

## Как это работает

- При каждом `git push origin main` Railway:
  1. Обнаруживает новый коммит
  2. Клонирует репозиторий
  3. Определяет тип проекта (Node.js)
  4. Устанавливает зависимости (`npm install`)
  5. Запускает приложение (`npm start`)
  6. Деплоит на сервер

## Мониторинг деплоев

- **Deployments** - история всех деплоев
- **Logs** - логи работы приложения в реальном времени
- **Metrics** - метрики использования ресурсов

## Откат к предыдущей версии

Если что-то пошло не так:

1. Перейдите в **Deployments**
2. Найдите нужный деплой
3. Нажмите **"Redeploy"** для отката

## Troubleshooting

### Деплой не запускается автоматически

**Проверьте следующие пункты:**

1. **Проверка подключения репозитория:**
   - Откройте Railway Dashboard → Ваш проект
   - Перейдите в **Settings** → **Service**
   - В разделе **"Source"** должно быть указано: `Nalivator3000/UA-IP-parcer`
   - Если репозиторий не подключен, нажмите **"Connect Repo"** или **"Change Source"**

2. **Проверка автодеплоя:**
   - В **Settings** → **Service** → **Deploy**
   - Убедитесь, что **"Auto Deploy"** включен (переключатель должен быть активен)
   - Проверьте, что выбрана ветка **`main`** в поле **"Branch"**

3. **Проверка GitHub интеграции:**
   - Перейдите в **Settings** → **Service** → **Source**
   - Убедитесь, что Railway имеет доступ к вашему GitHub репозиторию
   - Если нет, нажмите **"Configure GitHub App"** или **"Reconnect"**

4. **Проверка прав доступа:**
   - Убедитесь, что Railway App имеет доступ к репозиторию `UA-IP-parcer`
   - Проверьте настройки GitHub: Settings → Applications → Authorized OAuth Apps → Railway

5. **Проверка последнего коммита:**
   - Убедитесь, что вы пушите в ветку `main`:
     ```bash
     git push origin main
     ```
   - Проверьте, что коммит появился на GitHub

6. **Ручной запуск деплоя:**
   - В Railway Dashboard → **Deployments**
   - Нажмите **"Deploy"** или **"Redeploy"** для ручного запуска
   - Это поможет проверить, работает ли деплой вообще

7. **Проверка логов:**
   - Откройте **Deployments** → выберите последний деплой
   - Проверьте логи сборки на наличие ошибок
   - Ошибки могут указывать на проблему с конфигурацией

8. **Проверка webhook'ов (если ничего не помогает):**
   - На GitHub: Settings → Webhooks
   - Должен быть webhook от Railway
   - Проверьте последние доставки (Recent Deliveries)
   - Если webhook не работает, переподключите репозиторий в Railway

### Ошибки при деплое

1. Проверьте логи в Railway Dashboard
2. Убедитесь, что все переменные окружения установлены
3. Проверьте `package.json` и `railway.json` на корректность

### Приложение не запускается

1. Проверьте логи в разделе **Logs**
2. Убедитесь, что `DATABASE_URL` корректна
3. Проверьте, что порт настроен правильно (Railway использует переменную `PORT`)

