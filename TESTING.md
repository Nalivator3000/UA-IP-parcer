# Локальное тестирование перед деплоем

## Быстрый старт

1. **Запустите сервер:**
   ```bash
   cd csv_export_app
   npm install
   npm start
   ```

2. **В другом терминале запустите тесты:**
   ```bash
   cd csv_export_app
   node test_local.js
   ```

## Что тестируется

- ✅ Health check (проверка подключения к БД)
- ✅ Получение типов событий (`/api/event-types`)
- ✅ Экспорт данных (маленький период)
- ✅ Валидация (без выбранных событий)

## Если тесты падают

1. **Проверьте, что сервер запущен:**
   - Откройте http://localhost:3000/api/health
   - Должен вернуться `{"status":"ok","database":"connected"}`

2. **Проверьте подключение к БД:**
   - Убедитесь, что `DATABASE_URL` правильный
   - Проверьте, что БД доступна

3. **Проверьте логи сервера:**
   - Смотрите консоль, где запущен `npm start`
   - Ищите ошибки подключения или таймауты

## Перед коммитом

**ВАЖНО:** Всегда запускайте тесты перед коммитом!

```bash
# 1. Запустите сервер
npm start

# 2. В другом терминале запустите тесты
node test_local.js

# 3. Если все тесты прошли - можно коммитить
git add .
git commit -m "Описание изменений"
git push
```

## Если запросы зависают

1. Проверьте таймауты в `server.js`
2. Убедитесь, что БД отвечает быстро
3. Проверьте индексы на таблице `user_events`:
   - `external_user_id`
   - `user_agent`
   - `ip_address`
   - `event_date`

